# ğŸ§± dbt (Data Build Tool) â€” Complete Guide for Data Engineers

---

## ğŸŒŸ 1ï¸âƒ£ What is dbt?

**dbt (Data Build Tool)** is an open-source **data transformation framework** that enables **analytics engineers** to transform raw data in the **data warehouse** using **SQL and Jinja (templating)**.

It sits **after ingestion** (data already loaded into your warehouse from tools like Airflow, Fivetran, or Glue).

---

## âš™ï¸ 2ï¸âƒ£ Where dbt Fits in a Modern Data Stack

| Layer | Tool Example | Purpose |
|--------|----------------|----------|
| **Extract** | Fivetran, Airbyte, AWS Glue | Pull raw data into warehouse |
| **Load** | Snowflake COPY, Redshift COPY | Store raw data |
| **Transform (T in ELT)** | ğŸ§± **dbt** | Clean, join, and model data using SQL |
| **Visualize** | Looker, Tableau, Power BI | Consume clean data |

âœ… dbt turns your warehouse into a **version-controlled transformation engine**.

---

## ğŸ§© 3ï¸âƒ£ Key dbt Concepts

| Concept | Description |
|----------|-------------|
| **Model** | A SQL file that defines a transformation (`SELECT` query). Output becomes a table/view. |
| **Project** | Folder containing all dbt code (models, tests, macros, configs). |
| **Source** | Declaration of raw data tables in the warehouse (e.g., staging tables). |
| **Seed** | CSV file loaded directly into the warehouse for static reference data. |
| **Test** | Assertions that ensure data quality (e.g., uniqueness, not null). |
| **Macro** | Reusable SQL or Jinja function. |
| **Snapshot** | Tracks slowly changing dimensions (historical changes in data). |
| **Run** | Executes dbt models in dependency order. |
| **Docs** | Auto-generates data lineage and documentation site. |

---

## ğŸ§  4ï¸âƒ£ How dbt Works (Under the Hood)

1ï¸âƒ£ You write **SQL models** with Jinja templating.  
2ï¸âƒ£ dbt compiles them into **pure SQL** (resolving dependencies).  
3ï¸âƒ£ dbt executes these queries **inside your data warehouse** (Redshift, Snowflake, BigQuery, Databricks).  
4ï¸âƒ£ The results are materialized as **tables or views**.

ğŸ’¡ dbt **doesnâ€™t move data** â€” it transforms data **already in the warehouse**.

---

## ğŸ§° 5ï¸âƒ£ Installing & Initializing dbt

### Installation
```bash

pip install dbt-core dbt-redshift   # or dbt-snowflake, dbt-bigquery, etc.
```
### Create a New Project
``` bash

dbt init my_dbt_project
cd my_dbt_project

```

### Project Structure
``` bash
my_dbt_project/
â”‚
â”œâ”€â”€ dbt_project.yml
â”œâ”€â”€ profiles.yml
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ staging/
â”‚   â”‚   â””â”€â”€ stg_orders.sql
â”‚   â”œâ”€â”€ marts/
â”‚   â”‚   â””â”€â”€ fact_sales.sql
â”‚   â””â”€â”€ schema.yml
â””â”€â”€ seeds/

```

### Simple dbt Model
### models/staging/stg_orders.sql
``` sql
-- Transform raw orders data
SELECT
    order_id,
    customer_id,
    order_date,
    total_amount,
    status
FROM {{ source('raw', 'orders') }}
WHERE status != 'cancelled';

```

### models/marts/fact_sales.sql
``` sql
SELECT
    o.order_id,
    o.customer_id,
    c.customer_name,
    o.total_amount,
    DATE_TRUNC('month', o.order_date) AS month
FROM {{ ref('stg_orders') }} AS o
JOIN {{ ref('stg_customers') }} AS c
  ON o.customer_id = c.customer_id;

```

### Running dbt Commands
| Command                       | Description                            |
| ----------------------------- | -------------------------------------- |
| `dbt run`                     | Runs all models in dependency order    |
| `dbt test`                    | Runs data quality tests                |
| `dbt seed`                    | Loads static CSV data from `/seeds`    |
| `dbt docs generate`           | Builds documentation                   |
| `dbt docs serve`              | Opens documentation UI                 |
| `dbt compile`                 | Compiles SQL to target/compiled folder |
| `dbt run --select stg_orders` | Run specific model                     |
| `dbt run --full-refresh`      | Rebuild all tables/views               |


### dbt Tests (Data Quality)
### models/schema.yml
version: 2
```yaml
models:
  - name: stg_orders
    description: "Cleansed orders data"
    columns:
      - name: order_id
        tests:
          - not_null
          - unique
      - name: total_amount
        tests:
          - not_null

```
# Built-in tests: unique, not_null, accepted_values, relationships
### dbt Sources
Define your raw data tables:

```yaml
version: 2

sources:
  - name: raw
    schema: public
    tables:
      - name: orders
      - name: customers

```



